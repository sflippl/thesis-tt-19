"0","set.seed(529)"
"0","df_course <- "
"0","    df_metric %>% "
"0","    mutate(day = ymd(str_split_fixed(event_nr, ""_"", 4)[,2])) %>% "
"0","    mutate(day_nr = day-ymd(""2019-06-30""))"
"0","df_ratio <- "
"0","    df_course %>% "
"0","    ungroup() %>% "
"0","    select(day_nr, rate, direction, scope, event_nr, perturbation, previous, true_strategy) %>% "
"0","    spread(key = 'direction', value = 'rate', fill = 0) %>% "
"0","    mutate(difference = R-L) %>% "
"0","    spread(key = 'scope', value = 'difference', fill = 0) %>% "
"0","    mutate(change = future-past) %>%"
"0","    mutate(dummy_perturbation = if_else(perturbation == ""Perturbation"", 1, 0),"
"0","           day_nr = as.double(day_nr))"
"0","course_left <- lm(change~dummy_perturbation:exp(-0.1*day_nr)+dummy_perturbation+exp(-day_nr), data = df_ratio %>% filter(true_strategy == 'left'))"
"0","course_nls_left <- nls(formula = change~a*exp(-tau*day_nr)+b+c*exp(-tau_c*day_nr)*dummy_perturbation, start = list(tau = 1,a = 12.43, b=-2.9, c = 0.06, tau_c = 0.1), data = df_ratio %>% filter(true_strategy == 'left'), control = nls.control(minFactor = 1/100000, maxiter = 500))"
"0","course_nls_left_2 <- nls(formula = change ~a*exp(-tau*day_nr)+b+c*exp(-tau_c*day_nr)*dummy_perturbation+d*dummy_perturbation, start = list(tau = 0.3,a = 4.1, b=-3.2, c = 0.3, tau_c = -0.1, d=0.05), data = df_ratio %>% filter(true_strategy == 'left'), control = nls.control(minFactor = 1/100000, maxiter = 500))"
"0","course_right <- lm(change~dummy_perturbation:exp(-0.05*day_nr)+exp(-day_nr)+dummy_perturbation, data = df_ratio %>% filter(true_strategy == 'right'))"
"0","course_nls_right <- nls(formula = change~a*exp(-tau*day_nr)*(1-dummy_perturbation)+b+c*exp(-tau_c*day_nr)*dummy_perturbation, start = list(tau = 1,a = 0.7, b=0.6, c = 0.05, tau_c = 0.05), data = df_ratio %>% filter(true_strategy == 'right'), control = nls.control(minFactor = 1/10000))"
"0","course_nls_right_2 <- nls(formula = change ~a*exp(-tau*day_nr)+b+c*exp(-tau_c*day_nr)*dummy_perturbation+d*dummy_perturbation, start = list(tau = -0.24,a = 0.005, b=0.57, c = -0.3, tau_c = -0.005, d=-0.1), data = df_ratio %>% filter(true_strategy == 'right'), control = nls.control(minFactor = 1/100000, maxiter = 500))"
"0","df_fit <- bind_rows(broom::augment(course_nls_left_2, data = df_ratio %>% filter(true_strategy == 'left')), broom::augment(course_nls_right_2, data = df_ratio %>% filter(true_strategy == 'right')))"
"0","df_ratio %>% "
"0","    ggplot(aes(x = day_nr+1, y = change, linetype = perturbation)) + "
"0","    annotate('rect', xmin = -Inf, xmax = Inf, ymin = 0, ymax = Inf, fill = ""#d95f02"", alpha = .2) + "
"0","    annotate('rect', xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = 0, fill = ""#1b9e77"", alpha = .2) +"
"0","    stat_summary(fun.data = 'mean_cl_boot') + "
"0","    facet_grid(perturbation ~ previous) + "
"0","    geom_line(stat = 'identity', aes(y = .fitted), color = 'blue', data = df_fit) + "
"0","    theme_bw() + "
"0","    theme(legend.position = 'none') + "
"0","    labs(linetype = NULL, x = 'Day', y = 'Change in Lickrate Difference') + "
"0","    geom_label(aes(x = x, y = y, label = label), data = tibble(x = c(10, 10), "
"0","                                                               y = c(4, -4),"
"0","                                                               label = c(""Event leads to more right licks"","
"0","                                                                         ""Event leads to more left licks""),"
"0","                                                               previous = c(""'Leftwards!'"", ""'Rightwards!'""),"
"0","                                                               perturbation = ""No perturbation"")) + "
"0","    ggsave('figs/exp_learning.png')"
"2","Saving 7 x 7 in image
"
