"0","df_center <- "
"0","    df_change"
"0","kruskal_test <- kruskal.test(spikerate ~ is_perturbed, data = df_center)"
"0","prentice_test <- "
"0","    prentice.test(df_center[['normalized_spikerate']], "
"0","                  df_center[['is_perturbed']], "
"0","                  paste(df_center[['change']], df_center[['centered_id']]))"
"2","30688 observation(s) in blocks with <2 of 'df_center[[""is_perturbed""]]' (groups) removed."
"0","df_change_f09 <- feather::read_feather('data/gtmk444f-07-09/df_change.feather')"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"0","df_normalization_f09 <- "
"0","    df_change_f09 %>% "
"0","    filter(norm_id == 0) %>% "
"0","    group_by(neuron_id) %>% "
"0","    summarise(normalization = mean(spikerate))"
"0","df_change_f09 <- "
"0","    df_change_f09 %>% "
"0","    left_join(df_normalization_f09, by = 'neuron_id') %>% "
"0","    mutate(normalized_spikerate = spikerate/normalization)"
"0","df_center_f09 <- df_change_f09"
"0","prentice_test_f09 <- "
"0","    prentice.test(df_center_f09[['normalized_spikerate']], "
"0","                  df_center_f09[['is_perturbed']], "
"0","                  paste(df_center_f09[['change']], df_center_f09[['centered_id']]))"
"2","20936 observation(s) in blocks with <2 of 'df_center_f09[[""is_perturbed""]]' (groups) removed."
"0","df_center_g05 <- feather::read_feather('data/gtmk444g-07-05/df_change.feather')"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"0","df_normalization_g05 <- "
"0","    df_center_g05 %>% "
"0","    filter(norm_id == 0) %>% "
"0","    group_by(neuron_id) %>% "
"0","    summarise(normalization = mean(spikerate))"
"0","df_center_g05 <- "
"0","    df_center_g05 %>% "
"0","    left_join(df_normalization_g05, by = 'neuron_id') %>% "
"0","    mutate(normalized_spikerate = spikerate/normalization)"
"0","prentice_test_g05 <- "
"0","    prentice.test(df_center_g05[['normalized_spikerate']], "
"0","                  df_center_g05[['is_perturbed']], "
"0","                  paste(df_center_g05[['change']], df_center_g05[['centered_id']]))"
"2","10824 observation(s) in blocks with <2 of 'df_center_g05[[""is_perturbed""]]' (groups) removed."
"0","no_perturbations <- "
"0","    df_center %>% "
"0","    group_by(neuron_id) %>% "
"0","    summarize(statistic = all(!is_perturbed)) %>% "
"0","    filter(statistic) %>% "
"0","    extract2('neuron_id')"
"0","df_difference <- "
"0","    df_center %>% "
"0","    filter(!(neuron_id %in% no_perturbations)) %>% "
"0","    group_by(neuron_id) %>% "
"0","    summarize(statistic = prentice.test(normalized_spikerate, is_perturbed, paste(change, norm_id))$statistic,"
"0","              effect = prentice.test(normalized_spikerate, is_perturbed, paste(change, norm_id))$effect,"
"0","              p_value = prentice.test(normalized_spikerate, is_perturbed, paste(change, norm_id))$p.value)"
"2","425 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","400 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","427 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","418 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","380 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","408 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","475 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","432 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","435 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","454 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","447 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","478 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","482 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","456 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","459 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","420 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","453 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","444 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","403 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","430 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","448 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","457 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","461 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","440 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","441 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","466 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","385 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","430 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","464 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","447 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","471 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","436 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","425 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","451 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","469 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","486 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","454 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","484 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","462 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","469 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","478 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","479 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","449 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","444 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","438 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","451 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","465 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","453 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","473 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","464 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","471 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","470 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","472 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","483 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","466 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","468 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","425 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","400 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","427 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","418 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","380 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","408 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","475 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","432 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","435 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","454 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","447 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","478 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","482 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","456 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","459 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","420 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","453 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","444 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","403 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","430 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","448 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","457 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","461 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","440 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","441 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","466 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","385 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","430 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","464 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","447 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","471 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","436 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","425 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","451 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","469 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","486 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","454 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","484 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","462 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","469 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","478 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","479 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","449 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","444 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","438 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","451 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","465 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","453 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","473 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","464 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","471 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","470 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","472 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","483 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","466 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","468 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","425 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","400 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","427 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","418 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","380 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","408 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","475 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","432 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","435 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","454 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","447 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","478 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","482 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","456 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","459 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","420 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","453 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","444 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","403 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","430 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","448 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","457 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","461 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","440 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","441 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","466 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","385 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","430 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","464 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","447 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","471 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","436 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","425 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","451 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","469 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","486 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","454 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","484 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","462 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","469 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","478 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","460 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","463 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","479 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","449 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","444 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","438 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","451 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","465 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","453 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","473 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","464 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","471 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","470 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","472 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","483 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","466 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","455 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"2","468 observation(s) in blocks with <2 of 'is_perturbed' (groups) removed."
"0","# Under a uniform distribution, how likely would we have gotten this distribution?"
"0","# We measure that by looking at the median value"
"0","n <- nrow(df_difference)"
"0","test_stat <- sum(df_difference$p_value <= 0.05)/n"
"0","sim_stat <- c()"
"0","for (i in 1:10000) {"
"0","    sim_stat <- c(sim_stat, sum(runif(n) <= 0.05)/n)"
"0","}"
"0","load('data/sim_stat.RData')"
"0","percentile <- sum(sim_stat >= test_stat)/10000"
"0","p_test <- "
"0","    ggplot(df_difference, aes(x = p_value)) + "
"0","    geom_histogram(binwidth = 0.05) + "
"0","    theme_bw()"
"0","sim_df <- tibble(sim_stat = sim_stat)"
"0","p_sim <- "
"0","    sim_df %>% "
"0","    group_by(sim_stat) %>% "
"0","    summarise(count = n()/nrow(sim_df)) %>% "
"0","    ggplot(aes(x = sim_stat, y = count)) + "
"0","    geom_bar(aes(fill = sim_stat >= test_stat), show.legend = FALSE,"
"0","             stat = 'identity') + "
"0","    geom_vline(xintercept = test_stat) + "
"0","    scale_fill_manual(values = c(`TRUE` = 'orange', `FALSE` = 'grey40')) + "
"0","    theme_bw() + "
"0","    scale_y_continuous(labels = scales::percent) + "
"0","    ylab('Proportion') + "
"0","    xlab('Proportion of p values under 0.05')"
"0","critical_neurons <-"
"0","    df_difference %>% "
"0","    filter(p_value <= 0.1) %>% "
"0","    extract2('neuron_id')"
"0","df_pert <- "
"0","    df_change %>% "
"0","    filter(neuron_id %in% critical_neurons)"
"0","pert_tuning <- "
"0","    df_pert %>% "
"0","    mutate(frequency = freq_trans(centered_id)) %>% "
"0","    mutate(pert = if_else(is_perturbed, 'Perturbation', 'No perturbation')) %>% "
"0","    ggplot(aes(x = frequency, y = spikerate, linetype = pert)) + "
"0","    stat_summary(geom = 'linerange', fun.data = 'mean_cl_boot') + "
"0","    stat_summary(geom = 'line', fun.y = 'mean') + "
"0","    facet_wrap(~neuron_id, scales = 'free_y') + "
"0","    theme_bw() + "
"0","    scale_x_log10(minor_breaks = NULL) +"
"0","    scale_y_continuous(breaks = NULL) +"
"0","    labs(linetype = NULL, x = 'Frequency (kHz)', y = 'Spikerate') + "
"0","    theme(strip.text.x = element_blank(),"
"0","          legend.position = 'none')"
"0","df_best_response_2 <- feather::read_feather('data/df_best_response_2.feather')"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"0","pert_response <- "
"0","    df_best_response_2 %>% "
"0","    filter(neuron_id %in% critical_neurons) %>% "
"0","    mutate(frequency = freq_trans(centered_id)) %>% "
"0","    mutate(pert = if_else(perturbation != 0, 'Perturbation', 'No perturbation')) %>% "
"0","    mutate(time = frame/29.7*1000) %>% "
"0","    ggplot(aes(x = time, y = spikes, linetype = pert)) + "
"0","    annotate('rect', xmin = 0, xmax = 200, ymin = -Inf, ymax = Inf, alpha = 0.5) + "
"0","    stat_summary(geom = 'line', fun.y = 'mean') + "
"0","    theme_bw() + "
"0","    facet_wrap(~neuron_id, scales = 'free_y') + "
"0","    theme(strip.text.x = element_blank(),"
"0","          axis.text.x = element_text(),"
"0","          axis.text.y = element_blank()) + "
"0","    xlab('Time (ms)') + "
"0","    scale_x_continuous(breaks = NULL, limits = c(-150, 300)) + "
"0","    scale_y_continuous(breaks = NULL) +"
"0","    ylab('Average response to best frequency') +"
"0","    labs(linetype = NULL) + "
"0","    theme(strip.text.x = element_blank(),"
"0","          legend.position = 'top')"
"0","df_1 <- feather::read_feather('data/df_1.feather')"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"2","Coercing int64 to double"
"0","response_curve <- "
"0","    df_1 %>% "
"0","    filter(centered_id >= 0) %>% "
"0","    mutate(frequency = round(freq_trans(centered_id))) %>% "
"0","    mutate(pert = case_when("
"0","        perturbation < 0 ~ 'Expected higher sound',"
"0","        perturbation == 0 ~ 'No perturbation',"
"0","        perturbation > 0 ~ 'Expected lower sound'"
"0","    )) %>% "
"0","    group_by(frame, frequency, pert) %>% "
"0","    summarise(spikes = mean(spikes)) %>% "
"0","    mutate(time = frame/29.7*1000) %>% "
"0","    ggplot(aes(x = time, y = spikes, linetype = pert, colour = pert)) + "
"0","    annotate('rect', xmin = 0, xmax = 200, ymin = -Inf, ymax = Inf, alpha = 0.5) + "
"0","    geom_line() + "
"0","    theme_bw() + "
"0","    xlab('Time (ms)') + "
"0","    ylab('Average response to frequency (Hz)') + "
"0","    scale_x_continuous(breaks = NULL, minor_breaks = NULL, limits = c(-150, 300)) + "
"0","    facet_wrap(~frequency, nrow = 1) + "
"0","    theme(legend.position = 'top', legend.key = element_rect(fill = 'grey'), legend.direction = 'vertical') + "
"0","    scale_linetype_manual(values = c(`No perturbation` = 1, `Expected higher sound` = 2, `Expected lower sound` = 2)) +"
"0","    scale_color_manual(values = c(`No perturbation` = 'black', `Expected higher sound` = ""#FFEA46FF"", `Expected lower sound` = ""purple"")) +"
"0","    labs(linetype = NULL, color = NULL)"
"0","effect_plot <- df_difference %>% "
"0","    ggplot(aes(x = effect)) + "
"0","    geom_histogram() + "
"0","    theme_bw()"
"0","whole_tuning <- df_pert %>% "
"0","    mutate(frequency = freq_trans(centered_id)) %>% "
"0","    mutate(pert = if_else(is_perturbed, 'Perturbation', 'No perturbation')) %>% "
"0","    ggplot(aes(x = norm_id, y = normalized_spikerate, linetype = pert)) + "
"0","    stat_summary(geom = 'linerange', fun.data = 'mean_cl_boot') + "
"0","    stat_summary(geom = 'line', fun.y = 'mean') + "
"0","    theme_bw() + "
"0","    ylab('Average spikerate (Hz)') + "
"0","    xlab('Logarithmic distance from best frequency') + "
"0","    labs(linetype = NULL) + "
"0","    xlim(-5, 5) +"
"0","    theme(legend.position = 'none',"
"0","          legend.box.background = element_rect(fill = 'transparent', color = 'transparent'), "
"0","          legend.background = element_rect(fill = 'transparent'),"
"0","          legend.justification = c(0,1))"
"0","(p_test + p_sim)/(pert_tuning + whole_tuning)/(pert_response+response_curve) + plot_annotation(tag_levels = 'a') + plot_layout(guides = 'collect') + ggsave('figs/perturbation_sensitivity.png')"
"2","Saving 7 x 7 in image
"
