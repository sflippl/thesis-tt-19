"0","freq_trans <- function(x) 2^(3.5+x/6)"
"0","df_tuning_field <- feather::read_feather('data/df_tuning_field.feather')"
"2","Coercing int64 to double"
"0","map <- "
"0","    df_tuning_field %>% "
"0","    mutate(y = -y) %>%"
"0","    mutate(frequency = freq_trans(centered_id)) %>% "
"0","    ggplot(aes(x = x, y = y, color = frequency)) + "
"0","    geom_point(size = 5) + "
"0","    theme_void() + "
"0","    coord_flip() + "
"0","    labs(color = 'Frequency (kHz)') +"
"0","    scale_color_viridis_c(trans = scales::log10_trans(), limits = c(4, 50)) + "
"0","    theme(plot.background = element_rect(fill = 'transparent'), panel.background = element_rect(color = 'black', fill = 'transparent'), legend.text = element_text(size = 20), legend.title = element_text(size = 20), legend.position = 'none', legend.key.size = unit(0.5, 'in')) + "
"0","    ggsave('figs/map.png')"
"2","Saving 7 x 7 in image
"
"0","df_best_response <- feather::read_feather('data/df_best_response.feather')"
"0","df_change <- feather::read_feather('data/df_change.feather')"
"0","df_normalization <- "
"0","    df_change %>% "
"0","    filter(norm_id == 0) %>% "
"0","    group_by(neuron_id) %>% "
"0","    summarise(normalization = mean(spikerate))"
"0","df_change <- "
"0","    df_change %>% "
"0","    left_join(df_normalization, by = 'neuron_id') %>% "
"0","    mutate(normalized_spikerate = spikerate/normalization)"
"0","best_50 <- df_best_response %>% "
"0","    filter(best_50) %>% "
"0","    extract2(""neuron_id"") %>% "
"0","    unique()"
"0","tuning_curves <- "
"0","    df_change %>% "
"0","    filter(neuron_id %in% best_50) %>%"
"0","    mutate(frequency = freq_trans(centered_id)) %>% "
"0","    ggplot(aes(x = frequency, y = spikerate)) + "
"0","    facet_wrap(~neuron_id, scales = 'free_y') + "
"0","    stat_summary(geom = 'linerange', fun.data = 'mean_cl_boot') + "
"0","    stat_summary(geom = 'line', fun.y = 'mean') + "
"0","    theme_bw() + "
"0","    theme(strip.text.x = element_blank(),"
"0","          axis.text.x = element_text(),"
"0","          axis.title = element_text()) + "
"0","    scale_x_log10(breaks = c(7, 20)) + "
"0","    scale_y_continuous(breaks = NULL) +"
"0","    xlab('Frequency (kHz)') + "
"0","    ylab('Average spikerate after stimulus onset')"
"0","df_trace <- feather::read_feather('data/df_trace.feather')"
"0","trace <- "
"0","    df_trace %>% "
"0","    mutate(time = frame/29.7*1000) %>% "
"0","    filter(time < 400, time > -150) %>%"
"0","    ggplot(aes(x = time, y = spikes)) + "
"0","    annotate('rect', xmin = 0, xmax = 200, ymin = -Inf, ymax = Inf, alpha = 0.5) + "
"0","    stat_summary(geom = 'line', fun.y = 'mean') + "
"0","    theme_bw() + "
"0","    facet_wrap(~neuron_id, scales = 'free_y') + "
"0","    theme(strip.text.x = element_blank()) + "
"0","    xlab('Time (ms)') + "
"0","    scale_x_continuous(breaks = NULL, minor_breaks = NULL) + "
"0","    scale_y_continuous(breaks = NULL) +"
"0","    ylab('Average response to best frequency')"
"0","average_tuning <- "
"0","    df_change %>% "
"0","    mutate(norm_id = (centered_id - best_response)/6) %>% "
"0","    ggplot(aes(x = norm_id, y = normalized_spikerate)) + "
"0","    stat_summary(geom = 'linerange', fun.data = 'mean_cl_boot') + "
"0","    stat_summary(geom = 'line', fun.y = 'mean') + "
"0","    theme_bw() + "
"0","    xlim(-1.2,1.2) + "
"0","    ylab('Average spikerate') + "
"0","    xlab('Distance from best frequency (octaves)')"
"0","widefield <- readPNG('figs/new.png') %>% rasterGrob(interpolate = TRUE)"
"0","wrap_elements(widefield) + average_tuning + tuning_curves + trace + plot_annotation(tag_levels = 'a') + plot_layout(nrow = 2) + ggsave('figs/tuning_curves.png')"
